class t{constructor(){this.states=[],this.defaults={objectName:"cpCurrencyWidgets",className:"coinpaprika-currency-widget",cssFileName:"widget.min.css",currency:"btc-bitcoin",primary_currency:"USD",range_list:["24h","7d","30d","1q","1y","ytd","all"],range:"24h",modules:["market_details","chart"],update_active:!1,update_timeout:"30s",language:"en",customDate:!1,startDate:null,endDate:null,style_src:null,img_src:null,lang_src:null,data_src:null,origin_src:"https://unpkg.com/@coinpaprika/widget-currency@latest",show_details_currency:!1,ticker:{name:void 0,symbol:void 0,price:void 0,price_change_24h:void 0,rank:void 0,price_ath:void 0,volume_24h:void 0,market_cap:void 0,percent_from_price_ath:void 0,volume_24h_change_24h:void 0,market_cap_change_24h:void 0},interval:null,isWordpress:!1,isNightMode:!1,isData:!1,availableModules:["price","chart","market_details"],message:"data_loading",translations:{},mainElement:null,noTranslationLabels:[],scriptsDownloaded:{},chart:null,rwd:{xs:280,s:320,m:370,l:462}}}init(t){if(!this.getMainElement(t))return console.error('Bind failed, no element with class = "'+this.defaults.className+'"');let e=Promise.resolve();return e=e.then((()=>this.getDefaults(t))),e=e.then((()=>this.setOriginLink(t))),e}setWidgetClass(t){for(let e=0;e<t.length;e++){let s=t[e].getBoundingClientRect().width,a=Object.keys(this.defaults.rwd);for(let i=0;i<a.length;i++){let n=a[i],r=this.defaults.rwd[n],l=this.defaults.className+"__"+n;s<=r&&t[e].classList.add(l),s>r&&t[e].classList.remove(l)}}}getMainElement(t){return this.states[t]?this.states[t].mainElement:null}getDefaults(t){return new Promise((e=>{let a=this.getMainElement(t);return a&&a.dataset?(a.dataset.modules||"extended"!==a.dataset.version||this.updateData(t,"modules",["market_details"]),a.dataset.modules||"standard"!==a.dataset.version||this.updateData(t,"modules",[]),a.dataset.modules&&this.updateData(t,"modules",JSON.parse(a.dataset.modules)),a.dataset.primaryCurrency&&this.updateData(t,"primary_currency",a.dataset.primaryCurrency),a.dataset.currency&&this.updateData(t,"currency",a.dataset.currency),a.dataset.customDate&&this.updateData(t,"customDate",a.dataset.customDate),a.dataset.startDate&&this.updateData(t,"startDate",a.dataset.startDate),a.dataset.endDate&&this.updateData(t,"endDate",a.dataset.endDate),a.dataset.range&&this.updateData(t,"range",a.dataset.range),a.dataset.showDetailsCurrency&&this.updateData(t,"show_details_currency","true"===a.dataset.showDetailsCurrency),a.dataset.updateActive&&this.updateData(t,"update_active","true"===a.dataset.updateActive),a.dataset.updateTimeout&&this.updateData(t,"update_timeout",s.parseIntervalValue(a.dataset.updateTimeout)),a.dataset.language&&this.updateData(t,"language",a.dataset.language),a.dataset.originSrc&&this.updateData(t,"origin_src",a.dataset.originSrc),a.dataset.nodeModulesSrc&&this.updateData(t,"node_modules_src",a.dataset.nodeModulesSrc),a.dataset.bowerSrc&&this.updateData(t,"bower_src",a.dataset.bowerSrc),a.dataset.styleSrc&&this.updateData(t,"style_src",a.dataset.styleSrc),a.dataset.langSrc&&this.updateData(t,"logo_src",a.dataset.langSrc),a.dataset.imgSrc&&this.updateData(t,"logo_src",a.dataset.imgSrc),e()):e()}))}setOriginLink(t){0===Object.keys(this.defaults.translations).length&&this.getTranslations(this.defaults.language);let e=Promise.resolve();return e=e.then((()=>this.stylesheet())),e=e.then((()=>this.addWidgetElement(t))),e=e.then((()=>this.initInterval(t))),e}addWidgetElement(t){let a=this.getMainElement(t),i="",n=[],r=null,l=Promise.resolve();return l=l.then((()=>s.loop(this.defaults.availableModules,(e=>this.states[t].modules.indexOf(e)>-1?n.push(e):null)))),l=l.then((()=>s.loop(n,(e=>{let s=null;return"chart"===e&&(s="Chart"),"market_details"===e&&(s="MarketDetails"),s?this[`widget${s}Element`](t).then((t=>i+=t)):null})))),l=l.then((()=>a.innerHTML=this.widgetMainElement(t)+i+this.widgetFooter(t))),l=l.then((()=>(r=document.getElementById(`${this.defaults.className}-price-chart-${t}`),r?r.parentElement.insertAdjacentHTML("beforeend",this.widgetSelectElement(t,"range")):null))),l=l.then((()=>(r&&(this.states[t].chart=new e(r,this.states[t]),this.setSelectListeners(t)),null))),l=l.then((()=>this.setBeforeElementInFooter(t))),l=l.then((()=>this.getData(t))),l}setSelectListeners(t){let e=this.getMainElement(t).querySelectorAll(".cp-widget-select");for(let s=0;s<e.length;s++){let a=e[s].querySelectorAll(".cp-widget-select__options button");for(let e=0;e<a.length;e++)a[e].addEventListener("click",(e=>{this.setSelectOption(e,t)}),!1)}}setSelectOption(t,e){let s="cp-widget-active";for(let e=0;e<t.target.parentNode.childNodes.length;e++){let a=t.target.parentNode.childNodes[e];a.classList.contains(s)&&a.classList.remove(s)}let a=t.target.closest(".cp-widget-select"),i=a.dataset.type,n=a.querySelector(".cp-widget-select__options > span"),r=t.target.dataset.option;n.innerText=this.getTranslation(e,r.toLowerCase()),this.updateData(e,i,r),t.target.classList.add(s),this.dispatchEvent(e,"-switch-range",r)}dispatchEvent(t,e,s){let a=`${this.defaults.className}-price-chart-${t}`;return document.dispatchEvent(new CustomEvent(`${a}${e}`,{detail:{data:s}}))}getData(t){const e="https://api.coinpaprika.com/v1/widget/"+this.states[t].currency+"?quote="+this.states[t].primary_currency;return a.fetchData(e).then((e=>e.json().then((e=>{this.states[t].isData||this.updateData(t,"isData",!0),this.updateTicker(t,e)})))).catch((e=>this.onErrorRequest(t,e)))}onErrorRequest(t,e){this.states[t].isData&&this.updateData(t,"isData",!1),this.updateData(t,"message","data_unavailable"),console.error("Request failed.  Returned status of "+e,this.states[t])}initInterval(t){clearInterval(this.states[t].interval),this.states[t].update_active&&this.states[t].update_timeout>1e3&&(this.states[t].interval=setInterval((()=>{this.getData(t)}),this.states[t].update_timeout))}setBeforeElementInFooter(t){if(!this.states[t].isWordpress){let e=this.getMainElement(t);if(e){"style"===e.children[0].localName&&e.removeChild(e.childNodes[0]);let s=e.querySelector(".cp-widget__footer"),a=s.getBoundingClientRect().width-43;for(let t=0;t<s.childNodes.length;t++)a-=s.childNodes[t].getBoundingClientRect().width;let i=document.createElement("style");i.innerHTML=".cp-widget__footer--"+t+"::before{width:"+a.toFixed(0)+"px;}",e.insertBefore(i,e.children[0])}}}updateWidgetElement(t,e,a,i){let n=this.states[t],r=this.getMainElement(t);if(r){let l=i?"Ticker":"";if("name"===e||"currency"===e){if("currency"===e){let t=r.querySelectorAll(".cp-widget__footer > a");for(let e=0;e<t.length;e++)t[e].href=this.coin_link(a)}this.getImage(t)}if("isData"===e||"message"===e){let e=r.querySelectorAll(".cp-widget__main");for(let s=0;s<e.length;s++)e[s].innerHTML=n.isData?this.widgetMainElementData(t):this.widgetMainElementMessage(t)}else{let t=r.querySelectorAll("."+e+l);for(let i=0;i<t.length;i++){let r=t[i];if(r.classList.contains("cp-widget__rank")){let t=parseFloat(a)>0?"cp-widget__rank-up":parseFloat(a)<0?"cp-widget__rank-down":"cp-widget__rank-neutral";r.classList.remove("cp-widget__rank-down"),r.classList.remove("cp-widget__rank-up"),r.classList.remove("cp-widget__rank-neutral"),void 0===a?a=s.emptyData:(r.classList.add(t),a="price_change_24h"===e?"("+s.round(a,2)+"%)":s.round(a,2)+"%")}if(r.classList.contains("showDetailsCurrency")&&!n.show_details_currency&&(a=" "),r.classList.contains("parseNumber")){const t=this.defaults.data_src||this.defaults.origin_src;let e=Promise.resolve();return e=e.then((()=>s.parseCurrencyNumber(a,n.primary_currency,t))),e=e.then((t=>r.innerHTML=t||s.emptyData)),e}r.innerText=a||s.emptyData}}}}updateData(t,e,s,a){a?this.states[t].ticker[e]=s:this.states[t][e]=s,"language"===e&&this.getTranslations(s),"customDate"===e&&(this.defaults.customDate=!!s),"startDate"===e&&(this.defaults.startDate=s??!1),"endDate"===e&&(this.defaults.endDate=s??!1),this.updateWidgetElement(t,e,s,a)}updateWidgetTranslations(t,e){this.defaults.translations[t]=e;for(let e=0;e<this.states.length;e++){let s=this.states[e].noTranslationLabels.length>0&&"en"===t;if(this.states[e].language===t||s){let t=this.states[e].mainElement,s=Array.prototype.slice.call(t.querySelectorAll(".cp-translation"));for(let t=0;t<s.length;t++)s[t].classList.forEach((a=>{if(a.search("translation_")>-1){let i=a.replace("translation_","");"message"===i&&(i=this.states[e].message);let n=this.states[e].noTranslationLabels.indexOf(i),r=this.getTranslation(e,i);n>-1&&r&&this.states[e].noTranslationLabels.splice(n,1),s[t].innerText=r,s[t].closest(".cp-widget__footer")&&setTimeout((()=>this.setBeforeElementInFooter(e)),50)}}))}}}updateTicker(t,e){let s=Object.keys(e);for(let a=0;a<s.length;a++)this.updateData(t,s[a],e[s[a]],!0)}stylesheet(){if(!1!==this.defaults.style_src){let t=this.defaults.style_src||this.defaults.origin_src+"/dist/"+this.defaults.cssFileName;return document.body.querySelector('link[href="'+t+'"]')?Promise.resolve():a.fetchStyle(t)}return Promise.resolve()}widgetMainElement(t){let e=this.states[t];return'<div class="cp-widget__header"><div class="cp-widget__img cp-widget__img-'+e.currency+'"><img/></div><div class="cp-widget__main">'+(e.isData?this.widgetMainElementData(t):this.widgetMainElementMessage(t))+"</div></div>"}widgetMainElementData(t){let e=this.states[t];const a=e.ticker.price_change_24h>0?"up":e.ticker.price_change_24h<0?"down":"neutral",i=window.self!==window.top,n=`\n      <span class="nameTicker">${e.ticker.name||s.emptyData}</span>\n      <span class="symbolTicker">${e.ticker.symbol||s.emptyData}</span>\n    `;return`\n      <h3>${i?n:`<a href="${this.coin_link(e.currency)}">${n}</a>`}</h3>\n      <strong>\n        <span class="priceTicker parseNumber">${s.parseNumber(e.ticker.price)||s.emptyData}</span> \n        <span class="primaryCurrency">${e.primary_currency} </span>\n        <span class="price_change_24hTicker cp-widget__rank cp-widget__rank-${a}">\n          (${s.round(e.ticker.price_change_24h,2)||s.emptyValue}%)\n        </span>\n      </strong>\n      <span class="cp-widget__rank-label">\n        <span class="cp-translation translation_rank">${this.getTranslation(t,"rank")}</span> \n        <span class="rankTicker">${e.ticker.rank||s.emptyData}</span>\n      </span>\n    `}widgetMainElementMessage(t){let e=this.states[t].message;return'<div class="cp-widget__main-no-data cp-translation translation_message">'+this.getTranslation(t,e)+"</div>"}widgetMarketDetailsElement(t){return Promise.resolve(this.states[t].modules.indexOf("market_details")>-1?'<div class="cp-widget__details">'+this.widgetAthElement(t)+this.widgetVolume24hElement(t)+this.widgetMarketCapElement(t)+"</div>":"")}widgetAthElement(t){return'<div><small class="cp-translation translation_ath">'+this.getTranslation(t,"ath")+'</small><div><span class="price_athTicker parseNumber">'+s.emptyData+' </span><span class="symbolTicker showDetailsCurrency"></span></div><span class="percent_from_price_athTicker cp-widget__rank">'+s.emptyData+"</span></div>"}widgetVolume24hElement(t){return'<div><small class="cp-translation translation_volume_24h">'+this.getTranslation(t,"volume_24h")+'</small><div><span class="volume_24hTicker parseNumber">'+s.emptyData+' </span><span class="symbolTicker showDetailsCurrency"></span></div><span class="volume_24h_change_24hTicker cp-widget__rank">'+s.emptyData+"</span></div>"}widgetMarketCapElement(t){return'<div><small class="cp-translation translation_market_cap">'+this.getTranslation(t,"market_cap")+'</small><div><span class="market_capTicker parseNumber">'+s.emptyData+' </span><span class="symbolTicker showDetailsCurrency"></span></div><span class="market_cap_change_24hTicker cp-widget__rank">'+s.emptyData+"</span></div>"}widgetChartElement(t){return Promise.resolve(`<div class="cp-widget__chart"><div id="${this.defaults.className}-price-chart-${t}"></div></div>`)}widgetSelectElement(t,e){let s="";for(let a=0;a<this.states[t][e+"_list"].length;a++){let i=this.states[t][e+"_list"][a];s+='<button class="'+(i.toLowerCase()===this.states[t][e].toLowerCase()?"cp-widget-active ":"")+("primary_currency"===e?"":"cp-translation translation_"+i.toLowerCase())+'" data-option="'+i+'">'+this.getTranslation(t,i.toLowerCase())+"</button>"}return'<div data-type="'+e+'" class="cp-widget-select"><label class="cp-translation translation_'+e+'">'+this.getTranslation(t,"zoom_in")+'</label><div class="cp-widget-select__options"><span class="arrow-down cp-widget__capitalize cp-translation translation_'+this.states[t][e].toLowerCase()+'">'+this.getTranslation(t,this.states[t][e].toLowerCase())+'</span><div class="cp-widget-select__dropdown">'+s+"</div></div></div>"}widgetFooter(t){let e=this.states[t].currency;return this.states[t].isWordpress?"":'<p class="cp-widget__footer cp-widget__footer--'+t+'"><span class="cp-translation translation_powered_by">'+this.getTranslation(t,"powered_by")+' </span><img style="width: 16px" src="'+this.main_logo_link()+'" alt=""/><a target="_blank" href="'+this.coin_link(e)+'">coinpaprika.com</a></p>'}getImage(t){let e=this.states[t],s=e.mainElement.getElementsByClassName("cp-widget__img");for(let t=0;t<s.length;t++){let a=s[t];a.classList.add("cp-widget__img--hidden");let i=a.querySelector("img"),n=new Image;n.onload=()=>{i.src=n.src,a.classList.remove("cp-widget__img--hidden")},n.src=this.img_src(e.currency)}}img_src(t){return"https://coinpaprika.com/coin/"+t+"/logo.png"}coin_link(t){return"https://coinpaprika.com/coin/"+t}main_logo_link(){return this.defaults.img_src||this.defaults.origin_src+"/dist/img/logo_widget.svg"}getScriptElement(){return document.querySelector("script[data-cp-currency-widget]")}getTranslation(t,e){let s=this.defaults.translations[this.states[t].language]?this.defaults.translations[this.states[t].language][e]:null;return!s&&this.defaults.translations.en&&(s=this.defaults.translations.en[e]),s||this.addLabelWithoutTranslation(t,e)}addLabelWithoutTranslation(t,e){return this.defaults.translations.en||this.getTranslations("en"),this.states[t].noTranslationLabels.push(e)}getTranslations(t){if(!this.defaults.translations[t]){const e=this.defaults.lang_src||this.defaults.origin_src+"/dist/lang/"+t+".json";return this.defaults.translations[t]={},a.fetchJsonFile(e,!0).then((s=>{s?this.updateWidgetTranslations(t,s):(this.onErrorRequest(0,e+s),this.getTranslations("en"),delete this.defaults.translations[t])}))}}}class e{constructor(t,e){t&&(this.id=t.id,this.isNightMode=e.isNightMode,this.chartsWithActiveSeriesCookies=[],this.chart=null,this.currency=e.currency,this.container=t,this.options=this.setOptions(),this.defaultRange=e.range||"7d",this.customDate=e.customDate||!1,this.startDate=e.startDate||!1,this.endDate=e.endDate||!1,this.callback=null,this.replaceCallback=null,this.extremesDataUrl=this.getExtremesDataUrl(t.id),this.firstPrice=null,this.lastPrice=null,this.defaultOptions={chart:{alignTicks:!1,marginTop:50,style:{fontFamily:"sans-serif"},events:{render:t=>{var e,a,i;if((null==(e=null==this?void 0:this.chart_data)?void 0:e.price)&&(null==(i=null==(a=null==this?void 0:this.chart_data)?void 0:a.price)?void 0:i.length)>0){const t=this.chart_data.price[0],e=this.chart_data.price[this.chart_data.price.length-1],s=t[1],a=e[1],i=this.getPriceSeries();s&&a&&this.firstPrice!==s&&this.lastPrice!==a&&(this.firstPrice=s,this.lastPrice=a,i.update(a>=s?this.getChartPositiveGradient():this.getChartNegativeGradient(),!0))}if(t.target.annotations){let e=t.target.annotations.chart;s.loop(e.annotations.allItems,(t=>{let s=e.plotHeight+e.plotTop-e.spacing[0]-2-(this.isResponsiveModeActive(e)?10:0);t.update({y:s},!0)}))}}}},scrollbar:{enabled:!1},annotationsOptions:{enabledButtons:!1},rangeSelector:{enabled:!1},plotOptions:{line:{series:{states:{hover:{enabled:!1}}}},series:{events:{legendItemClick:t=>(t.browserEvent.isTrusted&&this.chartsWithActiveSeriesCookies.indexOf(t.target.chart.renderTo.id)>-1&&this.setVisibleChartCookies(t),t.browserEvent.isTrusted)}}},xAxis:{ordinal:!1}},this.chartDataParser=t=>new Promise((s=>{t=t[0];const a=e.primary_currency.toLowerCase();return s({data:{price:t.price?t.price:t[a]?t[a]:[],volume:t.volume||[]}})})),this.isEventsHidden=!1,this.excludeSeriesIds=[],this.asyncUrl=`/currency/data/${e.currency}/_range_/`,this.asyncParams=`?quote=${e.primary_currency.toUpperCase()}&fields=price,volume`,this.init())}setOptions(){const t=new e;return{responsive:{rules:[{condition:{maxWidth:1500},chartOptions:{legend:{align:"right",verticalAlign:"middle",y:92,symbolRadius:0,itemDistance:20,itemStyle:{fontSize:10}},chart:{height:400,marginTop:35,marginBottom:0,spacingTop:0,spacingBottom:0},navigator:{height:50,margin:70,handles:{height:25,width:17}}}},{condition:{maxWidth:600},chartOptions:{chart:{marginTop:0,zoomType:"none",marginLeft:10,marginRight:10,height:350},yAxis:[{floor:0,tickAmount:7,tickWidth:0,tickLength:0,lineWidth:0,title:{enabled:!1},labels:{align:"left",x:1,y:-2,style:{color:"#9e9e9e",fontSize:"9px"}}},{floor:0,tickAmount:7,tickWidth:0,tickLength:0,lineWidth:0,title:{enabled:!1},labels:{align:"right",overflow:"justify",x:1,y:-2,style:{color:"#5085ec",fontSize:"9px"}}}]}},{condition:{maxWidth:450},chartOptions:{legend:{align:"right",verticalAlign:"middle",y:82,symbolRadius:0,itemDistance:20,itemStyle:{fontSize:10}},navigator:{margin:60,height:40,handles:{height:20}},chart:{height:300},yAxis:[{floor:0,tickAmount:7,tickWidth:0,tickLength:0,lineWidth:0,title:{enabled:!1},labels:{align:"left",x:1,y:-2,style:{color:"#9e9e9e",fontSize:"9px"}}},{floor:0,tickAmount:7,tickWidth:0,tickLength:0,lineWidth:0,title:{enabled:!1},labels:{align:"right",overflow:"justify",x:1,y:-2,style:{color:"#5085ec",fontSize:"9px"}}}]}}]},title:{text:void 0},chart:{backgroundColor:"none",marginTop:50,plotBorderWidth:0},cpEvents:!1,colors:["#5085ec","#1f9809","#985d65","#ee983b","#4c4c4c"],legend:{margin:0,enabled:!0,align:"right",symbolRadius:0,itemDistance:40,itemStyle:{fontWeight:"normal",color:this.isNightMode?"#80a6e5":"#0645ad"},itemMarginTop:8},navigator:!0,tooltip:{shared:!0,split:!1,animation:!1,borderWidth:1,borderColor:this.isNightMode?"#4c4c4c":"#e3e3e3",hideDelay:100,shadow:!1,backgroundColor:"#ffffff",style:{color:"#4c4c4c",fontSize:"10px"},useHTML:!0,formatter:function(){return t.tooltipFormatter(this)}},exporting:{buttons:{contextButton:{enabled:!1}}},xAxis:{lineColor:this.isNightMode?"#505050":"#e3e3e3",tickColor:this.isNightMode?"#505050":"#e3e3e3",tickLength:7},yAxis:[{lineWidth:1,lineColor:"#dedede",tickWidth:1,tickLength:4,gridLineDashStyle:"dash",gridLineWidth:0,floor:0,minPadding:0,opposite:!1,showEmpty:!1,showLastLabel:!1,showFirstLabel:!1},{gridLineColor:this.isNightMode?"#505050":"#e3e3e3",gridLineDashStyle:"dash",lineWidth:1,tickWidth:1,tickLength:4,floor:0,minPadding:0,showEmpty:!1,opposite:!0,gridZIndex:4,showLastLabel:!1,showFirstLabel:!1}],series:[{color:"transparent",name:"Price",id:"price",data:[],type:"area",fillOpacity:.15,lineWidth:2,yAxis:1,zIndex:2,visible:!0,clickable:!0,threshold:null,tooltip:{valueDecimals:0},showInNavigator:!0,showInLegend:!1},{color:this.isNightMode?"#9b9b9b":"#e3e3e3",name:"Volume",id:"volume",data:[],type:"area",fillOpacity:.5,lineWidth:0,yAxis:0,zIndex:0,visible:!0,clickable:!0,threshold:null,tooltip:{valueDecimals:0},showInNavigator:!0}]}}init(){let t=Promise.resolve();return t=t.then((()=>this.parseOptions(this.options))),t=t.then((t=>(window.Highcharts.setOptions({lang:{numericSymbols:["k","M"]}}),window.Highcharts?Highcharts.stockChart(this.container.id,t,(t=>this.bind(t))):null))),t}getPriceSeries(){var t,e;return null==(e=null==(t=this.chart)?void 0:t.series)?void 0:e.find((t=>{var e;return"price"===(null==(e=t.userOptions)?void 0:e.id)}))}getChartPositiveGradient(){return{color:"#008000",fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"rgba(67, 170, 5, 0.4)"],[1,"rgba(67, 170, 5, 0)"]]}}}getChartNegativeGradient(){return{color:"#FF0000",fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"rgba(225, 82, 65, 0.4)"],[1,"rgba(225, 82, 65, 0)"]]}}}parseOptions(t){let e=Promise.resolve();return e=e.then((()=>s.updateObject(this.defaultOptions,t))),e=e.then((t=>s.updateObject(this.getVolumePattern(),t))),e=e.then((t=>this.setNavigator(t))),e=e.then((t=>t.noData?this.setNoDataLabel(t):t)),e=e.then((t=>t)),e}bind(t){let e=Promise.resolve();return e=e.then((()=>this.chart=t)),e=e.then((()=>this.customDate?this.fetchDataPackage(this.startDate,this.endDate,!0):this.fetchDataPackage())),e=e.then((()=>this.setRangeSwitcher())),e=e.then((()=>this.callback?this.callback(this.chart,this.defaultRange):null)),e}fetchDataPackage(t,e,s=!1){let a=!!t&&!!e,i=!!s||!a,n=Promise.resolve();return n=n.then((()=>{if(this.options.cpEvents){let s=a?this.getNavigatorExtremesUrl(t,e,"events"):this.getExtremesDataUrl(this.id,"events")+"/"+this.getRange()+"/";return s?this.fetchData(s,"events",i):null}return null})),n=n.then((()=>{let s=(a?this.getNavigatorExtremesUrl(t,e):this.asyncUrl.replace("_range_",this.getRange()))+this.asyncParams;return s?this.fetchData(s,"data",i):null})),n=n.then((()=>this.chart.redraw(!1))),n=n.then((()=>a?null:this.chart.zoomOut())),n=n.then((()=>this.isLoaded=!0)),n=n.then((()=>this.toggleEvents())),n}fetchData(t,e="data",s=!0){let i=Promise.resolve();return i=i.then((()=>(this.chart.showLoading(),a.fetchChartData(t,!this.isLoaded)))),i=i.then((t=>(this.chart.hideLoading(),200!==t.status?console.log(`Looks like there was a problem. Status Code: ${t.status}`):t.json().then((t=>{let a=Promise.resolve();return a=a.then((()=>this.dataParser(t,e))),a=a.then((t=>s?this.replaceData(t.data,e):this.updateData(t.data,e))),a}))))).catch((t=>(this.chart.hideLoading(),this.hideChart(),console.log("Fetch Error",t)))),i}hideChart(t=!0){const e=t?"add":"remove",a=s.nodeListToArray(this.container.parentElement.childNodes);let i=Promise.resolve();return i=i.then((()=>a.filter((t=>-1===t.id.search("chart"))))),i=i.then((t=>s.loop(t,(t=>t.classList[e]("cp-hidden"))))),i=i.then((()=>this.container.parentElement.classList[e]("cp-chart-no-data"))),i}setRangeSwitcher(){document.addEventListener(`${this.id}-switch-range`,(t=>(this.defaultRange=t.detail.data,this.fetchDataPackage())))}getRange(){return this.defaultRange||"1q"}toggleEvents(){let t=Promise.resolve();return this.options.cpEvents&&(t=t.then((()=>document.getElementsByClassName("highcharts-annotation"))),t=t.then((t=>s.loop(t,(t=>this.isEventsHidden?t.classList.contains("highcharts-annotation__hidden")?null:t.classList.add("highcharts-annotation__hidden"):t.classList.contains("highcharts-annotation__hidden")?t.classList.remove("highcharts-annotation__hidden"):null)))),t=t.then((()=>document.getElementsByClassName("highcharts-plot-line"))),t=t.then((t=>s.loop(t,(t=>this.isEventsHidden?t.classList.contains("highcharts-plot-line__hidden")?null:t.classList.add("highcharts-plot-line__hidden"):t.classList.contains("highcharts-plot-line__hidden")?t.classList.remove("highcharts-plot-line__hidden"):null))))),t}dataParser(t,e="data"){switch(e){case"data":let e=Promise.resolve();return e=e.then((()=>this.chartDataParser?this.chartDataParser(t):{data:t[0]})),e;case"events":return Promise.resolve(t);default:return null}}updateData(t,e){let a,i=Promise.resolve();return i=i.then((()=>{switch(e){case"data":return a={},s.loop(Object.entries(t),(t=>{if(this.isExcluded(t[0]))return;let s=this.getOldData(e)[t[0]];a[t[0]]=s.filter((s=>-1===t[1].findIndex((t=>this.isTheSameElement(s,t,e))))).concat(t[1]).sort(((t,s)=>this.sortCondition(t,s,e)))}));case"events":a=[];let i=this.getOldData(e);return a=i.filter((s=>{t.findIndex((t=>this.isTheSameElement(s,t,e)))})).concat(t).sort(((t,s)=>this.sortCondition(t,s,e)));default:return!1}})),i=i.then((()=>this.replaceData(a,e))),i}isTheSameElement(t,e,s){switch(s){case"data":return t[0]===e[0];case"events":return t.ts===e.ts;default:return!1}}sortCondition(t,e,s){switch(s){case"data":return t[0]-e[0];case"events":return t.ts-e.ts;default:return!1}}getOldData(t){return this["chart_"+t.toLowerCase()]}replaceData(t,e){let s=Promise.resolve();return s=s.then((()=>this["chart_"+e.toLowerCase()]=t)),s=s.then((()=>this.replaceDataType(t,e))),s=s.then((()=>this.replaceCallback?this.replaceCallback(this.chart,t,this.isLoaded,e):null)),s}replaceDataType(t,e){switch(e){case"data":return this.asyncUrl&&s.loop(["btc-bitcoin","eth-ethereum"],(e=>{let a=e.split("-")[0];this.asyncUrl.search(e)>-1&&t[a]&&(t[a]=[],s.loop(this.chart.series,(t=>{t.userOptions.id===a&&t.update({visible:!1})})))})),s.loop(Object.entries(t),(t=>{if(!this.isExcluded(t[0]))return this.chart.get(t[0])?this.chart.get(t[0]).setData(t[1],!1,!1,!1):this.chart.addSeries({id:t[0],data:t[1],showInNavigator:!0})}));case"events":let e=Promise.resolve();return e=e.then((()=>s.loop(this.chart.annotations.allItems,(t=>t.destroy())))),e=e.then((()=>this.setAnnotationsObjects(t))),e;default:return null}}isExcluded(t){return this.excludeSeriesIds.indexOf(t)>-1}tooltipFormatter(t,e="",s){s||(s=e);const a='<div class="cp-chart-tooltip-currency"><small>'+new Date(t.x).toUTCString()+"</small><table>";let i="";return t.points.forEach((t=>{var e,a,n;const r=(null==(a=null==(e=t.y)?void 0:e.toString())?void 0:a.includes("e"))?null==(n=t.y)?void 0:n.toPrecision(3):t.y.toLocaleString("en-US",{maximumFractionDigits:8});i+='<tr><td class="cp-chart-tooltip-currency__row"><svg class="cp-chart-tooltip-currency__icon" width="5" height="5"><rect x="0" y="0" width="5" height="5" fill="'+t.series.color+'" fill-opacity="1"></rect></svg>'+t.series.name+": "+r,t.series.name.toLowerCase().search(s.toLowerCase())})),a+i+"</table></div>"}setAnnotationsObjects(t){this.chart.series[0].xAxis.removePlotLine();let e=[],a=Promise.resolve();return a=a.then((()=>t.sort(((t,e)=>e.ts-t.ts)))),a=a.then((()=>s.loop(t,(t=>{let s=Promise.resolve();return s=s.then((()=>e.push({width:1,value:t.ts,dashStyle:"solid",zIndex:4,color:this.getEventTagParams().color}))),s=s.then((()=>this.chart.addAnnotation({xValue:t.ts,y:0,title:`<span title="Click to open" class="cp-chart-annotation__text">${this.getEventTagParams(t.tag).label}</span><span class="cp-chart-annotation__dataElement" style="display: none;">${JSON.stringify(t)}</span>`,shape:{type:"circle",params:{r:11,cx:9,cy:10.5,"stroke-width":1.5,fill:this.getEventTagParams().color}},events:{mouseover:t=>{if(MobileDetect.isMobile())return;let e=this.getEventDataFromAnnotationEvent(t);this.openEventContainer(e,t)},mouseout:()=>{MobileDetect.isMobile()||this.closeEventContainer(event)},click:t=>{let e=this.getEventDataFromAnnotationEvent(t);MobileDetect.isMobile()?this.openEventContainer(e,t):this.openEventPage(e)}}}))),s})))),a=a.then((()=>this.chart.series[0].xAxis.update({plotLines:e},!1))),a}setNavigator(t){let e={},a=Promise.resolve();return a=a.then((()=>(!0===t.navigator?(e={navigator:{enable:!0,margin:20,series:{lineWidth:1},maskFill:"rgba(102,133,194,0.15)"},chart:{zoomType:"x"},xAxis:{events:{setExtremes:t=>{("navigator"===t.trigger||"zoom"===t.trigger)&&t.min&&t.max&&document.dispatchEvent(new CustomEvent(this.id+"SetExtremes",{detail:{minDate:t.min,maxDate:t.max,e:t}}))}}}},this.navigatorExtremesListener(),this.setResetZoomButton()):t.navigator||(e={navigator:{enabled:!1}}),s.updateObject(t,e)))),a}setResetZoomButton(){let t=Promise.resolve();return t=t.then((()=>this.addContainer(this.id,"ResetZoom","cp-chart-reset-zoom","button"))),t=t.then((()=>this.getContainer("ResetZoom"))),t=t.then((t=>(t.classList.add("uk-button"),t.innerText="Reset zoom",t.addEventListener("click",(()=>{this.chart.zoomOut()}))))),t}navigatorExtremesListener(){let t=Promise.resolve();return t=t.then((()=>document.addEventListener(this.id+"SetExtremes",(t=>{let e=s.round(t.detail.minDate/1e3,0),a=s.round(t.detail.maxDate/1e3,0),i=Promise.resolve();return i=i.then((()=>this.fetchDataPackage(e,a))),i})))),t}getNavigatorExtremesUrl(t,e,s){let a=s?this.getExtremesDataUrl(this.id,s):this.extremesDataUrl;return t&&e&&a?a+"/dates/"+t+"/"+e+"/":null}setNoDataLabel(t){let e={},a=Promise.resolve();return a=a.then((()=>(e={lang:{noData:"We don't have data for this time period"},noData:{style:{fontFamily:"Arial",fontSize:"14px",color:"#000000"}}},s.updateObject(t,e)))),a}addContainer(t,e,s,a="div"){let i=document.createElement(a),n=document.getElementById(t);i.id=t+e,i.classList.add(s),n.appendChild(i)}getContainer(t){return document.getElementById(this.id+t)}getExtremesDataUrl(t,e="data"){return"/currency/"+e+"/"+this.currency}getVolumePattern(){return{defs:{patterns:[{id:"fill-pattern",path:{d:"M 3 0 L 3 10 M 8 0 L 8 10",stroke:"#e3e3e3",fill:"#f1f1f1",strokeWidth:2}},{id:"fill-pattern-night",path:{d:"M 3 0 L 3 10 M 8 0 L 8 10",stroke:"#9b9b9b",fill:"#383838",strokeWidth:2}}]}}}}new class{constructor(){this.widgets=new t,this.bind()}bind(){window[this.widgets.defaults.objectName]={},document.addEventListener("DOMContentLoaded",(()=>this.initWidgets()),!1),window[this.widgets.defaults.objectName].bindWidget=()=>{window[this.widgets.defaults.objectName].init=!1,this.initWidgets()}}initWidgets(){if(!window[this.widgets.defaults.objectName].init){window[this.widgets.defaults.objectName].init=!0;let t=Array.prototype.slice.call(document.getElementsByClassName(this.widgets.defaults.className));this.widgets.setWidgetClass(t),window.addEventListener("resize",(()=>{this.widgets.setWidgetClass(t);for(let e=0;e<t.length;e++)this.widgets.setBeforeElementInFooter(e)}),!1);let e=this.widgets.getScriptElement();if(e&&e.dataset&&e.dataset.cpCurrencyWidget){let t=JSON.parse(e.dataset.cpCurrencyWidget);if(Object.keys(t)){let e=Object.keys(t);for(let s=0;s<e.length;s++){let a=e[s].replace("-","_");this.widgets.defaults[a]=t[e[s]]}}}setTimeout((()=>(this.widgets.states=[],s.loop(t,((t,e)=>{let i=JSON.parse(JSON.stringify(this.widgets.defaults));i.isWordpress=t.classList.contains("wordpress"),i.isNightMode=t.classList.contains("cp-widget__night-mode"),i.mainElement=t,this.widgets.states.push(i);let n=Promise.resolve();return n=n.then((()=>i.modules.indexOf("chart")>-1&&!window.Highcharts?s.loop(["//code.highcharts.com/stock/highstock.js","//code.highcharts.com/modules/exporting.js","//code.highcharts.com/modules/no-data-to-display.js","//code.highcharts.com/modules/pattern-fill.js"],(t=>a.fetchScript(t))):null)),n=n.then((()=>this.widgets.init(e))),n})))),50)}}};const s=new class{constructor(){this.emptyValue=0,this.emptyData="-"}nodeListToArray(t){return Array.prototype.slice.call(t)}parseIntervalValue(t){let e="",s=1;return t.search("s")>-1&&(e="s",s=1e3),t.search("m")>-1&&(e="m",s=6e4),t.search("h")>-1&&(e="h",s=36e5),t.search("d")>-1&&(e="d",s=864e5),parseFloat(t.replace(e,""))*s}isFiat(t,e){e||Promise.resolve(!1);let s=Promise.resolve();return s=s.then((()=>{let t=e+"/dist/data/currencies.json";return a.fetchJsonFile(t,!0)})),s=s.then((e=>e[t.toUpperCase()])),s}updateObject(t,e){let a=t,i=Promise.resolve();return i=i.then((()=>s.loop(Object.keys(e),(t=>a.hasOwnProperty(t)&&"object"==typeof a[t]?this.updateObject(a[t],e[t]).then((e=>{a[t]=e})):a[t]=e[t])))),i=i.then((()=>a)),i}parseCurrencyNumber(t,e,s){let a=Promise.resolve();return a=a.then((()=>this.isFiat(e,s))),a=a.then((e=>e?this.parseNumber(t,2):this.parseNumber(t))),a}convertScientificToDecimalNotation(t){if(!t&&0!==t)return"";const e=Math.sign(t);if(/\d+\.?\d*e[+-]*\d+/i.test(t)){const e="0",s=String(t).toLowerCase().split("e"),a=s.pop();let i=Math.abs(a);const n=a/i,r=s[0].split(".");if(-1===n)r[0]=Math.abs(r[0]),t=`${e}.${new Array(i).join(e)}${r.join("")}`;else{const s=r[1];s&&(i-=s.length),t=r.join("")+new Array(i+1).join(e)}}return e<0&&(t=-t),t}parseNumber(t,e){var s,a,i,n;if(!t&&0!==t)return t;if(t===this.emptyValue||t===this.emptyData)return t;if((t=parseFloat(t))>1e5){let e=t.toFixed(0),s="K",a=e.slice(0,e.length-1);return t>1e9?(a=e.slice(0,e.length-7),s="B"):t>1e6&&(a=e.slice(0,e.length-4),s="M"),a.slice(0,a.length-2)+"."+a.slice(a.length-2)+" "+s}if(t<1e-7){const e=t.toString().includes("e")?this.convertScientificToDecimalNotation(t).toString():t.toString(),r=(null==(n=null==(i=null==(a=null==(s=e.split("."))?void 0:s[1])?void 0:a.match(/^0+/))?void 0:i[0])?void 0:n.length)||0,l=e.replace(/^0\.0+/,"").slice(0,3);return r?`0.0<sub>${r}</sub>${l}`:"0.00"}return t%1>0?((!e||t<.01)&&(e=2,t<1?e=8:t<10?e=6:t<1e3&&(e=4)),this.round(t,e).toLocaleString("en-US",{maximumFractionDigits:e})):t.toLocaleString("en-US",{minimumFractionDigits:2})}round(t,e=8,s="round"){t=parseFloat(t),e=Math.pow(10,e);let a=Math[s](t*e)/e;const i=a<1?6:2;return a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:i})}loop(t,e,s,a,i=0){const n=(s,a)=>{try{const n=e(t[i],i,t);n&&n.then?n.then(s).catch(a):s(n)}catch(t){a(t)}},r=(s,a)=>()=>this.loop(t,e,s,a,++i),l=(e,s)=>i<t.length?new Promise(n).then(r(e,s)).catch(s):e();return s?l(s,a):new Promise(l)}},a=new class{constructor(){this.state={}}fetchScript(t){return this.state[t]?Promise.resolve(null):(this.state[t]="pending",new Promise(((e,s)=>{const a=document.createElement("script");document.body.appendChild(a),a.addEventListener("load",(()=>{this.state&&(this.state[t]="downloaded"),e()})),a.addEventListener("error",(()=>{this.state&&delete this.state[t],s(new Error(`Failed to load image's URL: ${t}`))})),a.async=!0,a.src=t})))}fetchStyle(t){return this.state[t]?Promise.resolve(null):(this.state[t]="pending",new Promise(((e,s)=>{const a=document.createElement("link");a.setAttribute("rel","stylesheet"),document.body.appendChild(a),a.setAttribute("href",t),a.addEventListener("load",(()=>{this.state&&(this.state[t]="downloaded"),e()})),a.addEventListener("error",(()=>{this.state&&delete this.state[t],s(new Error(`Failed to load style URL: ${t}`))})),a.href=t})))}fetchChartData(t,e=!1){const s=`https://graphsv2.coinpaprika.com${t}`;return this.fetchData(s,e)}fetchData(t,e=!1){let s=Promise.resolve();return s=s.then((()=>{if(e){if("pending"===this.state[t]){return new Promise(((s,a)=>{setTimeout((()=>{s(this.fetchData(t,e))}),100)}))}if(this.state[t])return Promise.resolve(this.state[t].clone())}this.state[t]="pending";let s=Promise.resolve();return s=s.then((()=>fetch(t))),s=s.then((e=>(this.state[t]=e,e.clone()))),s})),s}fetchJsonFile(t,e=!1){return this.fetchData(t,e).then((t=>200===t.status&&t.json())).catch((()=>!1))}};
